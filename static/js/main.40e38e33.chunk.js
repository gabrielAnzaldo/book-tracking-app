(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,n){e.exports=n(41)},35:function(e,t,n){},39:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),s=n(22),r=n.n(s),c=n(11),l=(n(35),n(10)),i=n(5),h=n(6),u=n(8),f=n(7),d=n(9),k=n(13),m=n.n(k),p=n(17),b="https://reactnd-books-api.udacity.com",g=localStorage.token;g||(g=Math.random().toString(36).substr(-8));var v={Accept:"application/json",Authorization:g},S=function(e,t){return fetch("".concat(b,"/books/").concat(e.id),{method:"PUT",headers:Object(p.a)({},v,{"Content-Type":"application/json"}),body:JSON.stringify({shelf:t})}).then(function(e){return e.json()})},E=function(e,t){return fetch("".concat(b,"/search"),{method:"POST",headers:Object(p.a)({},v,{"Content-Type":"application/json"}),body:JSON.stringify({query:e,maxResults:t})}).then(function(e){return e.json()}).then(function(e){return e.books})},B=function(e){var t=e.author;return o.a.createElement("div",{className:"book-authors"},t)},y=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(o)))).onChangeHandler=function(e){n.props.onChangeShelf(e.target.value,n.props)},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"book-shelf-changer"},o.a.createElement("select",{value:this.props.bookReference.shelf,onChange:this.onChangeHandler},o.a.createElement("option",{value:"none",disabled:!0},"Move to..."),o.a.createElement("option",{value:"currentlyReading"},"Currently Reading"),o.a.createElement("option",{value:"wantToRead"},"Want to Read"),o.a.createElement("option",{value:"read"},"Read"),o.a.createElement("option",{value:"none"},"None")))}}]),t}(a.Component),j=function(e){return o.a.createElement("li",null,o.a.createElement("div",{className:"book"},o.a.createElement("div",{className:"book-top"},e&&e.imageLinks&&o.a.createElement("div",{className:"book-cover",style:{width:128,height:193,backgroundImage:"url(".concat(e.imageLinks.smallThumbnail,")")}}),o.a.createElement(y,{onChangeShelf:e.onChangeShelf,bookReference:e})),o.a.createElement("div",{className:"book-title"},e.title),e.authors&&e.authors.map(function(e){return o.a.createElement(B,{key:m()(),author:e})})))};j.defaultProps={authors:[]};var R=j,O=function(e){var t=e.shelfName,n=e.shelfBooks,a=e.onChangeShelf;return o.a.createElement("ol",{className:"books-grid"},n.map(function(e){return o.a.createElement(R,Object.assign({key:e.id},e,{onChangeShelf:a,currentBookShelf:t}))}))},C=function(e){var t=e.keyShelf,n=e.shelfData,a=e.onChangeShelf;return o.a.createElement("div",{className:"bookshelf"},o.a.createElement("h2",{className:"bookshelf-title"},n.shelfTitle),o.a.createElement("div",{className:"bookshelf-books"},o.a.createElement(O,{shelfName:t,shelfBooks:n.shelfBooks,onChangeShelf:a})))},N=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(f.a)(t).call(this,e))).onChangeSearchQuery=function(e){var t=e.target.value.trim(),a=n.props.existingBooks.currentlyReading.shelfBooks.concat(n.props.existingBooks.wantToRead.shelfBooks).concat(n.props.existingBooks.read.shelfBooks);t?E(t,20).then(function(e){e&&e.length>0?n.setState({resultingBooks:e.map(function(e){var t=a.findIndex(function(t){return t.id===e.id});return t>=0?Object.assign({},e,{shelf:a[t].shelf}):e})}):n.setState({resultingBooks:[]})}):n.setState({resultingBooks:[]})},n.onChangeShelf=function(e,t){var a=n.findBookInShelf(t);if("none"!==e){var o=n.selectedBooks[e];if(a.id>=0){if(a.shelf!==e){o.push(Object.assign({},t.bookReference,{shelf:e}));var s=n.selectedBooks[a.shelf],r=s.findIndex(function(e){return e.id===t.bookReference.id});s.splice(r,1),n.selectedBooks[a.shelf]=s}}else o.push(Object.assign({},t.bookReference,{shelf:e}));n.selectedBooks[e]=o}else if(a.id>=0){var c=n.selectedBooks[a.shelf],l=c.findIndex(function(e){return e.id===t.bookReference.id});c.splice(l,1),n.selectedBooks[a.shelf]=c}},n.onChangeRoute=function(){n.props.onAddBooksShelfs(n.selectedBooks)},n.findBookInShelf=function(e){var t={id:-1,shelf:""},a=n.selectedBooks.currentlyReading.concat(n.selectedBooks.wantToRead).concat(n.selectedBooks.read),o=a.findIndex(function(t){return t.id===e.bookReference.id});return t.id=o,o>=0&&(t.shelf=a[o].shelf),t},n.selectedBooks={currentlyReading:[],wantToRead:[],read:[]},n.state={resultingBooks:[]},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.inputSearch.focus()}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"search-books"},o.a.createElement("div",{className:"search-books-bar"},o.a.createElement("button",{className:"close-search",style:{cursor:"pointer"},onClick:this.onChangeRoute},"Back home"),o.a.createElement("div",{className:"search-books-input-wrapper"},o.a.createElement("input",{type:"text",placeholder:"Search by title or author",value:this.state.value,onKeyUp:function(t){return e.onChangeSearchQuery(t)},ref:function(t){e.inputSearch=t}}))),o.a.createElement("div",{className:"search-books-results"},o.a.createElement("ol",{className:"books-grid"},this.state.resultingBooks.map(function(t){return o.a.createElement(R,Object.assign({key:t.id},t,{onChangeShelf:e.onChangeShelf}))}))))}}]),t}(a.Component),w=(n(39),function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(f.a)(t)).call.apply(e,[this].concat(o)))).state={currentlyReading:{shelfTitle:"Currently Reading",shelfBooks:[],id:0},wantToRead:{shelfTitle:"Want to Read",shelfBooks:[],id:1},read:{shelfTitle:"Read",shelfBooks:[],id:2}},n.onChangeShelf=function(e,t){var a=t.bookReference.currentBookShelf;if(a!==e&&"none"!==e){var o,s=Object.assign({},n.state[a]);s.shelfBooks=s.shelfBooks.filter(function(e){return e.id!==t.bookReference.id});var r=n.state[e];r.shelfBooks.push(Object.assign({},t.bookReference,{shelf:e})),n.setState((o={},Object(l.a)(o,a,s),Object(l.a)(o,e,r),o)),S(t.bookReference,e).then(function(){return console.log("Book's shelf updated")})}},n.updateShelfState=function(e,t){n.setState(Object(l.a)({},t,Object.assign({},n.state[t],{shelfBooks:e})))},n.updateSelectedBooks=function(e){Object.keys(e).forEach(function(t){e[t].forEach(function(e){S(e,t).then(function(){return console.log("Book's shelf updated")})}),n.updateShelfState(e[t].concat(n.state[t].shelfBooks),t)})},n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;fetch("".concat(b,"/books"),{headers:v}).then(function(e){return e.json()}).then(function(e){return e.books}).then(function(t){if(t&&t.length){var n=[],a=[],o=[];t.forEach(function(e){switch(e.shelf){case"currentlyReading":n.push(e);break;case"wantToRead":a.push(e);break;case"read":o.push(e);break;default:console.log("none")}}),e.updateShelfState(n,"currentlyReading"),e.updateShelfState(a,"wantToRead"),e.updateShelfState(o,"read")}})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"app"},o.a.createElement(c.c,{path:"/search",render:function(t){var n=t.history;return o.a.createElement(N,{onAddBooksShelfs:function(t){e.updateSelectedBooks(t),n.push("/")},existingBooks:e.state})}}),o.a.createElement(c.c,{exact:!0,path:"/",render:function(){return o.a.createElement("div",{className:"list-books"},o.a.createElement("div",{className:"list-books-title"},o.a.createElement("h1",null,"MyReads")),o.a.createElement("div",{className:"list-books-content"},o.a.createElement("div",null,Object.keys(e.state).map(function(t){return o.a.createElement(C,{key:m()(),keyShelf:t,shelfData:e.state[t],onChangeShelf:e.onChangeShelf})}))),o.a.createElement("div",{className:"open-search"},o.a.createElement(c.b,{to:"/search",href:!0},"Add a book")))}}))}}]),t}(o.a.Component));r.a.render(o.a.createElement(c.a,{basename:"/"},o.a.createElement(w,null)),document.getElementById("root"))}},[[26,2,1]]]);
//# sourceMappingURL=main.40e38e33.chunk.js.map